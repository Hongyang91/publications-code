function [ sig , sig_p ] = ADPSEStaF3DEMK_Basis( x,D,v2,dbar,normalize )
%UNTITLED3 Summary of this function goes here
%   Detailed explanation goes here
nm=(x.'*x+dbar)/(1+v2*(x.'*x));
% nm=1;

% D(:,1)1 = D(:,1)(1); 
% D(:,1)2 = D(:,1)(2);
% D(:,2)1 = D(:,2)(1);
% D(:,2)2 = D(:,2)(2);
% D(:,3)1 = D(:,3)(1);
% D(:,3)2 = D(:,3)(2);
% x1 = x(1);
% x2 = x(2);
% if normalize == 0
%     sig=[exp(x.'*(x+nm.*D(:,1)))-1;exp(x.'*(x+nm.*D(:,2)))-1;exp(x.'*(x+nm.*D(:,3)))-1];
%     sig_p=[(2*x+nm.*D(:,1)+2*(1-v2*dbar)*x*D(:,1)'*x/(1+v2*(x.'*x))^2)'*exp(x'*(x+nm.*D(:,1)));
%            (2*x+nm.*D(:,2)+2*(1-v2*dbar)*x*D(:,2)'*x/(1+v2*(x.'*x))^2)'*exp(x'*(x+nm.*D(:,2)));
%            (2*x+nm.*D(:,3)+2*(1-v2*dbar)*x*D(:,3)'*x/(1+v2*(x.'*x))^2)'*exp(x'*(x+nm.*D(:,3)))];
    L=size(D,2);
    n=length(x);
    sig = zeros(L,1);
    sig_p = zeros(L,n);
    for i=1:size(D,2)
        sig(i,1)=exp(x.'*(x+nm.*D(:,i)))-1;
        sig_p(i,:)=(2*x+nm.*D(:,i)+2*(1-v2*dbar)*x*D(:,i)'*x/(1+v2*(x.'*x))^2)'*exp(x'*(x+nm.*D(:,i)));
    end
%            (2*x+nm.*d4+2*(1-v2*dbar)*x*d4'*x/(1+v2*(x.'*x))^2)'*exp(x'*(x+nm.*d4));
%            (2*x+nm.*d5+2*(1-v2*dbar)*x*d5'*x/(1+v2*(x.'*x))^2)'*exp(x'*(x+nm.*d5))];
%     sig_p = [[exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,1)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,1)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))...
%         exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,1)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,1)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))];...
%         [exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,2)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,2)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))...
%         exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,2)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,2)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))];...
%         [exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,3)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,3)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))...
%         exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,3)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,3)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))]];
% else
%     sig=[(exp(x.'*(x+nm.*D(:,1)))-1)/sqrt(exp((x+nm.*D(:,1)).'*(x+nm.*D(:,1))));...
%         (exp(x.'*(x+nm.*D(:,2)))-1)/sqrt(exp((x+nm.*D(:,2)).'*(x+nm.*D(:,2))));...
%         (exp(x.'*(x+nm.*D(:,3)))-1)/sqrt(exp((x+nm.*D(:,3)).'*(x+nm.*D(:,3))))];
%     sig_p = [[(exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,1)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,1)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp((x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(1/2) - (exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*exp((x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)*(2*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))*((2*D(:,1)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + 2*((2*D(:,1)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2)*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/(2*exp((x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(3/2))...
%         (exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,1)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,1)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp((x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(1/2) - (exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*exp((x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)*(2*((2*D(:,1)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2)*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + 2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))*((2*D(:,1)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1)))/(2*exp((x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(3/2))];...
%         [(exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,2)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,2)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp((x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(1/2) - (exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*exp((x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)*(2*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))*((2*D(:,2)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + 2*((2*D(:,2)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2)*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/(2*exp((x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(3/2))...
%         (exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,2)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,2)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp((x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(1/2) - (exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*exp((x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)*(2*((2*D(:,2)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2)*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + 2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))*((2*D(:,2)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1)))/(2*exp((x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(3/2))];...
%         [(exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,3)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,3)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp((x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(1/2) - (exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*exp((x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)*(2*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))*((2*D(:,3)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + 2*((2*D(:,3)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2)*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/(2*exp((x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(3/2))...
%         (exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,3)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,3)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp((x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(1/2) - (exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*exp((x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)*(2*((2*D(:,3)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2)*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + 2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))*((2*D(:,3)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1)))/(2*exp((x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2 + (x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))^2)^(3/2))]];
% end    

%     sig_p=[(2*x+nm.*D(:,1)+2*(1-dbar)*x*D(:,1)'*x/(1+x.'*x)^2)'*exp(x'*(x+nm.*D(:,1)));
%            (2*x+nm.*D(:,2)+2*(1-dbar)*x*D(:,2)'*x/(1+x.'*x)^2)'*exp(x'*(x+nm.*D(:,2)));
%            (2*x+nm.*D(:,3)+2*(1-dbar)*x*D(:,3)'*x/(1+x.'*x)^2)'*exp(x'*(x+nm.*D(:,3)))];
%     sig=[exp(x.'*(x+nm.*D(:,1)))/sqrt(exp((x).'*(x)))-1;...
%         exp(x.'*(x+nm.*D(:,2)))/sqrt(exp((x).'*(x)))-1;...
%         exp(x.'*(x+nm.*D(:,3)))/sqrt(exp((x).'*(x)))-1];
%     sig_p = [[(exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,1)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,1)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp(x1^2 + x2^2)^(1/2) - (x1*exp(x1^2 + x2^2)*exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/exp(x1^2 + x2^2)^(3/2)...
%         (exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,1)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,1)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,1)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp(x1^2 + x2^2)^(1/2) - (x2*exp(x1^2 + x2^2)*exp(x1*(x1 + (D(:,1)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,1)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/exp(x1^2 + x2^2)^(3/2)];...
%         [(exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,2)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,2)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp(x1^2 + x2^2)^(1/2) - (x1*exp(x1^2 + x2^2)*exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/exp(x1^2 + x2^2)^(3/2)...
%         (exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,2)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,2)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,2)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp(x1^2 + x2^2)^(1/2) - (x2*exp(x1^2 + x2^2)*exp(x1*(x1 + (D(:,2)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,2)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/exp(x1^2 + x2^2)^(3/2)];...
%         [(exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x1 + x1*((2*D(:,3)1*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + x2*((2*D(:,3)2*x1)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp(x1^2 + x2^2)^(1/2) - (x1*exp(x1^2 + x2^2)*exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/exp(x1^2 + x2^2)^(3/2)...
%         (exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))*(x2 + x1*((2*D(:,3)1*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)1*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2) + x2*((2*D(:,3)2*x2)/(v2*(x1^2 + x2^2) + 1) - (2*D(:,3)2*v2*x2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)^2 + 1) + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)))/exp(x1^2 + x2^2)^(1/2) - (x2*exp(x1^2 + x2^2)*exp(x1*(x1 + (D(:,3)1*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1)) + x2*(x2 + (D(:,3)2*(x1^2 + x2^2 + dbar))/(v2*(x1^2 + x2^2) + 1))))/exp(x1^2 + x2^2)^(3/2)]];
    
%     sig=[exp(x.'*(x+nm.*D(:,1)))/(exp((x).'*(x)))-1;...
%         exp(x.'*(x+nm.*D(:,2)))/(exp((x).'*(x)))-1;...
%         exp(x.'*(x+nm.*D(:,3)))/(exp((x).'*(x)))-1];
%     sig_p = [[(exp(((D(:,1)1*x1 + D(:,1)2*x2)*(x1^2 + x2^2 + dbar))/(v2*x1^2 + v2*x2^2 + 1))*(D(:,1)1*dbar + 3*D(:,1)1*x1^2 + D(:,1)1*x2^2 + D(:,1)1*v2*x1^4 + D(:,1)1*v2*x2^4 + 2*D(:,1)2*x1*x2 - D(:,1)1*dbar*v2*x1^2 + D(:,1)1*dbar*v2*x2^2 + 2*D(:,1)1*v2*x1^2*x2^2 - 2*D(:,1)2*dbar*v2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^2 ...
%         (exp(((D(:,1)1*x1 + D(:,1)2*x2)*(x1^2 + x2^2 + dbar))/(v2*x1^2 + v2*x2^2 + 1))*(D(:,1)2*dbar + D(:,1)2*x1^2 + 3*D(:,1)2*x2^2 + D(:,1)2*v2*x1^4 + D(:,1)2*v2*x2^4 + 2*D(:,1)1*x1*x2 + D(:,1)2*dbar*v2*x1^2 - D(:,1)2*dbar*v2*x2^2 + 2*D(:,1)2*v2*x1^2*x2^2 - 2*D(:,1)1*dbar*v2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^2];...
%         [(exp(((D(:,2)1*x1 + D(:,2)2*x2)*(x1^2 + x2^2 + dbar))/(v2*x1^2 + v2*x2^2 + 1))*(D(:,2)1*dbar + 3*D(:,2)1*x1^2 + D(:,2)1*x2^2 + D(:,2)1*v2*x1^4 + D(:,2)1*v2*x2^4 + 2*D(:,2)2*x1*x2 - D(:,2)1*dbar*v2*x1^2 + D(:,2)1*dbar*v2*x2^2 + 2*D(:,2)1*v2*x1^2*x2^2 - 2*D(:,2)2*dbar*v2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^2 ...
%         (exp(((D(:,2)1*x1 + D(:,2)2*x2)*(x1^2 + x2^2 + dbar))/(v2*x1^2 + v2*x2^2 + 1))*(D(:,2)2*dbar + D(:,2)2*x1^2 + 3*D(:,2)2*x2^2 + D(:,2)2*v2*x1^4 + D(:,2)2*v2*x2^4 + 2*D(:,2)1*x1*x2 + D(:,2)2*dbar*v2*x1^2 - D(:,2)2*dbar*v2*x2^2 + 2*D(:,2)2*v2*x1^2*x2^2 - 2*D(:,2)1*dbar*v2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^2];...
%         [(exp(((D(:,3)1*x1 + D(:,3)2*x2)*(x1^2 + x2^2 + dbar))/(v2*x1^2 + v2*x2^2 + 1))*(D(:,3)1*dbar + 3*D(:,3)1*x1^2 + D(:,3)1*x2^2 + D(:,3)1*v2*x1^4 + D(:,3)1*v2*x2^4 + 2*D(:,3)2*x1*x2 - D(:,3)1*dbar*v2*x1^2 + D(:,3)1*dbar*v2*x2^2 + 2*D(:,3)1*v2*x1^2*x2^2 - 2*D(:,3)2*dbar*v2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^2 ...
%         (exp(((D(:,3)1*x1 + D(:,3)2*x2)*(x1^2 + x2^2 + dbar))/(v2*x1^2 + v2*x2^2 + 1))*(D(:,3)2*dbar + D(:,3)2*x1^2 + 3*D(:,3)2*x2^2 + D(:,3)2*v2*x1^4 + D(:,3)2*v2*x2^4 + 2*D(:,3)1*x1*x2 + D(:,3)2*dbar*v2*x1^2 - D(:,3)2*dbar*v2*x2^2 + 2*D(:,3)2*v2*x1^2*x2^2 - 2*D(:,3)1*dbar*v2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^2]];
%     
%     sig=[exp(x.'*(x+nm.*D(:,1)))/(exp((x+nm.*D(:,1)).'*(x+nm.*D(:,1))))-1;...
%         exp(x.'*(x+nm.*D(:,2)))/(exp((x+nm.*D(:,2)).'*(x+nm.*D(:,2))))-1;...
%         exp(x.'*(x+nm.*D(:,3)))/(exp((x+nm.*D(:,3)).'*(x+nm.*D(:,3))))-1];
%     sig_p = [[-(exp(-((x1^2 + x2^2 + dbar)*(D(:,1)1^2*x1^2 + D(:,1)1^2*x2^2 + dbar*D(:,1)1^2 + v2*D(:,1)1*x1^3 + v2*D(:,1)1*x1*x2^2 + D(:,1)1*x1 + D(:,1)2^2*x1^2 + D(:,1)2^2*x2^2 + dbar*D(:,1)2^2 + v2*D(:,1)2*x1^2*x2 + v2*D(:,1)2*x2^3 + D(:,1)2*x2))/(v2*x1^2 + v2*x2^2 + 1)^2)*(- 4*D(:,1)1^2*dbar^2*v2*x1 - 4*D(:,1)1^2*dbar*v2*x1^3 - 4*D(:,1)1^2*dbar*v2*x1*x2^2 + 4*D(:,1)1^2*dbar*x1 + 4*D(:,1)1^2*x1^3 + 4*D(:,1)1^2*x1*x2^2 - D(:,1)1*dbar*v2^2*x1^4 + D(:,1)1*dbar*v2^2*x2^4 + 2*D(:,1)1*dbar*v2*x2^2 + D(:,1)1*dbar + D(:,1)1*v2^2*x1^6 + 3*D(:,1)1*v2^2*x1^4*x2^2 + 3*D(:,1)1*v2^2*x1^2*x2^4 + D(:,1)1*v2^2*x2^6 + 4*D(:,1)1*v2*x1^4 + 6*D(:,1)1*v2*x1^2*x2^2 + 2*D(:,1)1*v2*x2^4 + 3*D(:,1)1*x1^2 + D(:,1)1*x2^2 - 4*D(:,1)2^2*dbar^2*v2*x1 - 4*D(:,1)2^2*dbar*v2*x1^3 - 4*D(:,1)2^2*dbar*v2*x1*x2^2 + 4*D(:,1)2^2*dbar*x1 + 4*D(:,1)2^2*x1^3 + 4*D(:,1)2^2*x1*x2^2 - 2*D(:,1)2*dbar*v2^2*x1^3*x2 - 2*D(:,1)2*dbar*v2^2*x1*x2^3 - 2*D(:,1)2*dbar*v2*x1*x2 + 2*D(:,1)2*v2*x1^3*x2 + 2*D(:,1)2*v2*x1*x2^3 + 2*D(:,1)2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^3 ...
%         -(exp(-((x1^2 + x2^2 + dbar)*(D(:,1)1^2*x1^2 + D(:,1)1^2*x2^2 + dbar*D(:,1)1^2 + v2*D(:,1)1*x1^3 + v2*D(:,1)1*x1*x2^2 + D(:,1)1*x1 + D(:,1)2^2*x1^2 + D(:,1)2^2*x2^2 + dbar*D(:,1)2^2 + v2*D(:,1)2*x1^2*x2 + v2*D(:,1)2*x2^3 + D(:,1)2*x2))/(v2*x1^2 + v2*x2^2 + 1)^2)*(- 4*D(:,1)1^2*dbar^2*v2*x2 - 4*D(:,1)1^2*dbar*v2*x1^2*x2 - 4*D(:,1)1^2*dbar*v2*x2^3 + 4*D(:,1)1^2*dbar*x2 + 4*D(:,1)1^2*x1^2*x2 + 4*D(:,1)1^2*x2^3 - 2*D(:,1)1*dbar*v2^2*x1^3*x2 - 2*D(:,1)1*dbar*v2^2*x1*x2^3 - 2*D(:,1)1*dbar*v2*x1*x2 + 2*D(:,1)1*v2*x1^3*x2 + 2*D(:,1)1*v2*x1*x2^3 + 2*D(:,1)1*x1*x2 - 4*D(:,1)2^2*dbar^2*v2*x2 - 4*D(:,1)2^2*dbar*v2*x1^2*x2 - 4*D(:,1)2^2*dbar*v2*x2^3 + 4*D(:,1)2^2*dbar*x2 + 4*D(:,1)2^2*x1^2*x2 + 4*D(:,1)2^2*x2^3 + D(:,1)2*dbar*v2^2*x1^4 - D(:,1)2*dbar*v2^2*x2^4 + 2*D(:,1)2*dbar*v2*x1^2 + D(:,1)2*dbar + D(:,1)2*v2^2*x1^6 + 3*D(:,1)2*v2^2*x1^4*x2^2 + 3*D(:,1)2*v2^2*x1^2*x2^4 + D(:,1)2*v2^2*x2^6 + 2*D(:,1)2*v2*x1^4 + 6*D(:,1)2*v2*x1^2*x2^2 + 4*D(:,1)2*v2*x2^4 + D(:,1)2*x1^2 + 3*D(:,1)2*x2^2))/(v2*x1^2 + v2*x2^2 + 1)^3];...
%         [-(exp(-((x1^2 + x2^2 + dbar)*(D(:,2)1^2*x1^2 + D(:,2)1^2*x2^2 + dbar*D(:,2)1^2 + v2*D(:,2)1*x1^3 + v2*D(:,2)1*x1*x2^2 + D(:,2)1*x1 + D(:,2)2^2*x1^2 + D(:,2)2^2*x2^2 + dbar*D(:,2)2^2 + v2*D(:,2)2*x1^2*x2 + v2*D(:,2)2*x2^3 + D(:,2)2*x2))/(v2*x1^2 + v2*x2^2 + 1)^2)*(- 4*D(:,2)1^2*dbar^2*v2*x1 - 4*D(:,2)1^2*dbar*v2*x1^3 - 4*D(:,2)1^2*dbar*v2*x1*x2^2 + 4*D(:,2)1^2*dbar*x1 + 4*D(:,2)1^2*x1^3 + 4*D(:,2)1^2*x1*x2^2 - D(:,2)1*dbar*v2^2*x1^4 + D(:,2)1*dbar*v2^2*x2^4 + 2*D(:,2)1*dbar*v2*x2^2 + D(:,2)1*dbar + D(:,2)1*v2^2*x1^6 + 3*D(:,2)1*v2^2*x1^4*x2^2 + 3*D(:,2)1*v2^2*x1^2*x2^4 + D(:,2)1*v2^2*x2^6 + 4*D(:,2)1*v2*x1^4 + 6*D(:,2)1*v2*x1^2*x2^2 + 2*D(:,2)1*v2*x2^4 + 3*D(:,2)1*x1^2 + D(:,2)1*x2^2 - 4*D(:,2)2^2*dbar^2*v2*x1 - 4*D(:,2)2^2*dbar*v2*x1^3 - 4*D(:,2)2^2*dbar*v2*x1*x2^2 + 4*D(:,2)2^2*dbar*x1 + 4*D(:,2)2^2*x1^3 + 4*D(:,2)2^2*x1*x2^2 - 2*D(:,2)2*dbar*v2^2*x1^3*x2 - 2*D(:,2)2*dbar*v2^2*x1*x2^3 - 2*D(:,2)2*dbar*v2*x1*x2 + 2*D(:,2)2*v2*x1^3*x2 + 2*D(:,2)2*v2*x1*x2^3 + 2*D(:,2)2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^3 ...
%         -(exp(-((x1^2 + x2^2 + dbar)*(D(:,2)1^2*x1^2 + D(:,2)1^2*x2^2 + dbar*D(:,2)1^2 + v2*D(:,2)1*x1^3 + v2*D(:,2)1*x1*x2^2 + D(:,2)1*x1 + D(:,2)2^2*x1^2 + D(:,2)2^2*x2^2 + dbar*D(:,2)2^2 + v2*D(:,2)2*x1^2*x2 + v2*D(:,2)2*x2^3 + D(:,2)2*x2))/(v2*x1^2 + v2*x2^2 + 1)^2)*(- 4*D(:,2)1^2*dbar^2*v2*x2 - 4*D(:,2)1^2*dbar*v2*x1^2*x2 - 4*D(:,2)1^2*dbar*v2*x2^3 + 4*D(:,2)1^2*dbar*x2 + 4*D(:,2)1^2*x1^2*x2 + 4*D(:,2)1^2*x2^3 - 2*D(:,2)1*dbar*v2^2*x1^3*x2 - 2*D(:,2)1*dbar*v2^2*x1*x2^3 - 2*D(:,2)1*dbar*v2*x1*x2 + 2*D(:,2)1*v2*x1^3*x2 + 2*D(:,2)1*v2*x1*x2^3 + 2*D(:,2)1*x1*x2 - 4*D(:,2)2^2*dbar^2*v2*x2 - 4*D(:,2)2^2*dbar*v2*x1^2*x2 - 4*D(:,2)2^2*dbar*v2*x2^3 + 4*D(:,2)2^2*dbar*x2 + 4*D(:,2)2^2*x1^2*x2 + 4*D(:,2)2^2*x2^3 + D(:,2)2*dbar*v2^2*x1^4 - D(:,2)2*dbar*v2^2*x2^4 + 2*D(:,2)2*dbar*v2*x1^2 + D(:,2)2*dbar + D(:,2)2*v2^2*x1^6 + 3*D(:,2)2*v2^2*x1^4*x2^2 + 3*D(:,2)2*v2^2*x1^2*x2^4 + D(:,2)2*v2^2*x2^6 + 2*D(:,2)2*v2*x1^4 + 6*D(:,2)2*v2*x1^2*x2^2 + 4*D(:,2)2*v2*x2^4 + D(:,2)2*x1^2 + 3*D(:,2)2*x2^2))/(v2*x1^2 + v2*x2^2 + 1)^3];...
%         [-(exp(-((x1^2 + x2^2 + dbar)*(D(:,3)1^2*x1^2 + D(:,3)1^2*x2^2 + dbar*D(:,3)1^2 + v2*D(:,3)1*x1^3 + v2*D(:,3)1*x1*x2^2 + D(:,3)1*x1 + D(:,3)2^2*x1^2 + D(:,3)2^2*x2^2 + dbar*D(:,3)2^2 + v2*D(:,3)2*x1^2*x2 + v2*D(:,3)2*x2^3 + D(:,3)2*x2))/(v2*x1^2 + v2*x2^2 + 1)^2)*(- 4*D(:,3)1^2*dbar^2*v2*x1 - 4*D(:,3)1^2*dbar*v2*x1^3 - 4*D(:,3)1^2*dbar*v2*x1*x2^2 + 4*D(:,3)1^2*dbar*x1 + 4*D(:,3)1^2*x1^3 + 4*D(:,3)1^2*x1*x2^2 - D(:,3)1*dbar*v2^2*x1^4 + D(:,3)1*dbar*v2^2*x2^4 + 2*D(:,3)1*dbar*v2*x2^2 + D(:,3)1*dbar + D(:,3)1*v2^2*x1^6 + 3*D(:,3)1*v2^2*x1^4*x2^2 + 3*D(:,3)1*v2^2*x1^2*x2^4 + D(:,3)1*v2^2*x2^6 + 4*D(:,3)1*v2*x1^4 + 6*D(:,3)1*v2*x1^2*x2^2 + 2*D(:,3)1*v2*x2^4 + 3*D(:,3)1*x1^2 + D(:,3)1*x2^2 - 4*D(:,3)2^2*dbar^2*v2*x1 - 4*D(:,3)2^2*dbar*v2*x1^3 - 4*D(:,3)2^2*dbar*v2*x1*x2^2 + 4*D(:,3)2^2*dbar*x1 + 4*D(:,3)2^2*x1^3 + 4*D(:,3)2^2*x1*x2^2 - 2*D(:,3)2*dbar*v2^2*x1^3*x2 - 2*D(:,3)2*dbar*v2^2*x1*x2^3 - 2*D(:,3)2*dbar*v2*x1*x2 + 2*D(:,3)2*v2*x1^3*x2 + 2*D(:,3)2*v2*x1*x2^3 + 2*D(:,3)2*x1*x2))/(v2*x1^2 + v2*x2^2 + 1)^3 ...
%         -(exp(-((x1^2 + x2^2 + dbar)*(D(:,3)1^2*x1^2 + D(:,3)1^2*x2^2 + dbar*D(:,3)1^2 + v2*D(:,3)1*x1^3 + v2*D(:,3)1*x1*x2^2 + D(:,3)1*x1 + D(:,3)2^2*x1^2 + D(:,3)2^2*x2^2 + dbar*D(:,3)2^2 + v2*D(:,3)2*x1^2*x2 + v2*D(:,3)2*x2^3 + D(:,3)2*x2))/(v2*x1^2 + v2*x2^2 + 1)^2)*(- 4*D(:,3)1^2*dbar^2*v2*x2 - 4*D(:,3)1^2*dbar*v2*x1^2*x2 - 4*D(:,3)1^2*dbar*v2*x2^3 + 4*D(:,3)1^2*dbar*x2 + 4*D(:,3)1^2*x1^2*x2 + 4*D(:,3)1^2*x2^3 - 2*D(:,3)1*dbar*v2^2*x1^3*x2 - 2*D(:,3)1*dbar*v2^2*x1*x2^3 - 2*D(:,3)1*dbar*v2*x1*x2 + 2*D(:,3)1*v2*x1^3*x2 + 2*D(:,3)1*v2*x1*x2^3 + 2*D(:,3)1*x1*x2 - 4*D(:,3)2^2*dbar^2*v2*x2 - 4*D(:,3)2^2*dbar*v2*x1^2*x2 - 4*D(:,3)2^2*dbar*v2*x2^3 + 4*D(:,3)2^2*dbar*x2 + 4*D(:,3)2^2*x1^2*x2 + 4*D(:,3)2^2*x2^3 + D(:,3)2*dbar*v2^2*x1^4 - D(:,3)2*dbar*v2^2*x2^4 + 2*D(:,3)2*dbar*v2*x1^2 + D(:,3)2*dbar + D(:,3)2*v2^2*x1^6 + 3*D(:,3)2*v2^2*x1^4*x2^2 + 3*D(:,3)2*v2^2*x1^2*x2^4 + D(:,3)2*v2^2*x2^6 + 2*D(:,3)2*v2*x1^4 + 6*D(:,3)2*v2*x1^2*x2^2 + 4*D(:,3)2*v2*x2^4 + D(:,3)2*x1^2 + 3*D(:,3)2*x2^2))/(v2*x1^2 + v2*x2^2 + 1)^3]];
    